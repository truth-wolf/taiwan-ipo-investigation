<!-- æ•¸æ“šè¡¨æ ¼å€åŸŸ - ä¿®æ”¹ç‰ˆ -->
<div class="overflow-x-auto mb-12 fade-in">
  <!-- Placeholder for original filter elements that will be moved and enhanced -->
  <div id="initial-filter-elements" style="display: none">
    <select id="broker-filter"></select>
    <select id="date-filter"></select>
  </div>

  <!-- è¡¨æ ¼æ§åˆ¶é …å°‡ç”±JSå‹•æ…‹æ·»åŠ  -->

  <!-- ç¶“å…¸è¡¨æ ¼è¦–åœ– -->
  <div class="table-wrapper classic-view-table">
    <table id="csv-table" class="w-full bg-white rounded-lg shadow-card">
      <thead>
        <tr class="bg-secondary text-white text-left">
          <th class="p-4 rounded-tl-lg">åˆ¸å•†</th>
          <th class="p-4">ç”¢å“</th>
          <th class="p-4 dt-right font-bold">è²¬ä»»é¡</th>
          <th class="p-4 rounded-tr-lg">å‹Ÿé›†æœŸé–“</th>
        </tr>
      </thead>
      <tbody>
        <!-- è¡¨æ ¼æ•¸æ“šå°‡ç”±JavaScriptå‹•æ…‹è¼‰å…¥ -->
      </tbody>
    </table>
  </div>

  <!-- ç”¢å“è¦–åœ–è¡¨æ ¼å®¹å™¨ - å°‡ç”±JavaScriptå‹•æ…‹å‰µå»º -->
</div>

<!-- æ•¸æ“šè¦–è¦ºåŒ–å€åŸŸ - å°‡ç”±JavaScriptå‹•æ…‹å‰µå»º -->

<section
  id="insight-panel"
  class="bg-secondary text-white p-8 rounded-lg shadow-card fade-in relative"
>
  <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
    <span>æ®˜é…·äº‹å¯¦ãƒ»å³æ™‚æ­éœ²</span>
    <div class="relative">
      <button
        id="formula-info-btn"
        class="w-5 h-5 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors"
      >
        <i class="fas fa-info-circle text-xs"></i>
      </button>
      <!-- å…¬å¼èªªæ˜æµ®å‹•æ¡† -->
      <div
        id="formula-info"
        class="hidden absolute right-0 top-8 w-72 bg-white/10 backdrop-blur-sm rounded-lg p-4 shadow-xl z-10 text-xs"
      >
        <h4 class="font-semibold mb-2 text-white/90">ğŸ“Š è¨ˆç®—å…¬å¼èªªæ˜</h4>
        <ul class="space-y-2 text-white/80">
          <li>â€¢ æœ€é«˜è²¬ä»»é¡ = MAX(æ‰€æœ‰å•†å“è²¬ä»»é¡)</li>
          <li>â€¢ æœ€ä½è²¬ä»»é¡ = MIN(æ‰€æœ‰éé›¶è²¬ä»»é¡)</li>
          <li>â€¢ æœ€é«˜/æœ€ä½å€æ•¸ = æœ€é«˜è²¬ä»»é¡ / æœ€ä½è²¬ä»»é¡</li>
          <li>â€¢ å¹³å‡å‹Ÿé›†å¤©æ•¸ = SUM(å‹Ÿé›†å¤©æ•¸) / å•†å“æ•¸</li>
          <li>â€¢ æ¯æ—¥è²¬ä»»é¡ = è²¬ä»»é¡ / å‹Ÿé›†å¤©æ•¸</li>
          <li>â€¢ æ¯å°æ™‚é…é¡ = æ¯æ—¥è²¬ä»»é¡ / 8</li>
          <li>
            â€¢ åœ°ç„æœˆä»½è¨ˆç®—ï¼š <br />1. ä¾å¹´æœˆåˆ†çµ„çµ±è¨ˆå•†å“æ•¸ <br />2.
            æ‰¾å‡ºå–®æœˆå•†å“æ•¸æœ€å¤šçš„æœˆä»½ <br />3. é¡¯ç¤ºå¹´ä»½åŠè©²æœˆå•†å“æ•¸é‡
          </li>
        </ul>
      </div>
    </div>
  </h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 leading-relaxed">
    <!-- å·¦æ¬„ -->
    <ul class="space-y-4">
      <li class="flex items-start">
        <i class="fas fa-exclamation-triangle text-red-400 mt-1 mr-3"></i>
        <span>
          <strong>ç˜‹ç‹‚å¤©èŠ±æ¿</strong>ï¼šå–®æª”è²¬ä»»é¡æœ€é«˜
          <span id="ins-maxResp" class="counter text-yellow-300">0</span> è¬ï¼Œ
          æ˜¯æœ€ä½é¡åº¦çš„ <span id="ins-ratioResp" class="counter">0</span> å€ï¼
        </span>
      </li>

      <li class="flex items-start">
        <i class="fas fa-stopwatch text-orange-300 mt-1 mr-3"></i>
        <span>
          <strong>å£“ç¸®é€±æœŸ</strong>ï¼šå¹³å‡å‹Ÿé›†æœŸåƒ…
          <span id="ins-avgDays" class="counter">0</span> å¤©ï¼Œ å²ä¸Šæœ€çŸ­
          <span id="ins-minDays" class="counter">0</span> å¤©ï¼Œ æ¯”å‚³çµ± 30 å¤©å°‘
          <span id="ins-cutPct" class="counter">0</span>ï¼…ï¼
        </span>
      </li>

      <li class="flex items-start">
        <i class="fas fa-calendar-alt text-green-300 mt-1 mr-3"></i>
        <span>
          <strong>åœ°ç„æœˆä»½</strong>ï¼š
          <span id="ins-hellYear" class="counter">0</span> å¹´
          <span id="ins-hellMonth" class="counter">0</span> æœˆçˆ†å‡º
          <span id="ins-hellCount" class="counter">0</span> æª”å•†å“åŒæ­¥é–‹è³£
          <!-- <span class="text-xs text-white/70 block mt-1">
            <i class="fas fa-info-circle mr-1"></i>ä¾å•†å“ä»£ç¢¼å»é‡å¾Œè¨ˆç®—
          </span> -->
        </span>
      </li>
    </ul>

    <!-- å³æ¬„ -->
    <ul class="space-y-4">
      <li class="flex items-start">
        <i class="fas fa-burn text-pink-400 mt-1 mr-3"></i>
        <span>
          <strong>æ—¥çˆ†é‡</strong>ï¼šå¹³å‡æ¯æ—¥å¿…é ˆè¡
          <span id="ins-avgPerDay" class="counter">0</span> è¬è²¬ä»»é¡ï¼
        </span>
      </li>

      <li class="flex items-start">
        <i class="fas fa-hourglass-half text-blue-300 mt-1 mr-3"></i>
        <span>
          <strong>æ¯å°æ™‚ KPI</strong>ï¼š<span id="ins-hrQuota" class="counter"
            >0</span
          >
          è¬ï¼å°æ™‚ï¼Œå–˜å£æ°£éƒ½å¥¢ä¾ˆï¼
        </span>
      </li>

      <li class="flex items-start">
        <i class="fas fa-skull-crossbones text-red-500 mt-1 mr-3"></i>
        <span>
          <strong>æœ€ææ€–ä¸€å¤©</strong>ï¼š<span id="ins-peakDate">â€”</span>
          å–®æ—¥è²¬ä»»é¡é£†ç ´ <span id="ins-peakAmt" class="counter">0</span> è¬ï¼
        </span>
      </li>
    </ul>
  </div>

  <!-- æ·»åŠ å…¬å¼èªªæ˜çš„JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const formulaBtn = document.getElementById("formula-info-btn");
      const formulaInfo = document.getElementById("formula-info");
      let isVisible = false;

      // é»æ“ŠæŒ‰éˆ•åˆ‡æ›é¡¯ç¤º
      formulaBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        isVisible = !isVisible;
        formulaInfo.classList.toggle("hidden", !isVisible);
      });

      // é»æ“Šå…¶ä»–åœ°æ–¹é—œé–‰
      document.addEventListener("click", function (e) {
        if (isVisible && !formulaInfo.contains(e.target)) {
          isVisible = false;
          formulaInfo.classList.add("hidden");
        }
      });

      // æ»‘é¼ æ‡¸æµ®ä¹Ÿå¯ä»¥é¡¯ç¤º
      formulaBtn.addEventListener("mouseenter", function () {
        isVisible = true;
        formulaInfo.classList.remove("hidden");
      });

      formulaBtn.addEventListener("mouseleave", function (e) {
        // æª¢æŸ¥æ»‘é¼ æ˜¯å¦ç§»å‹•åˆ°å…¬å¼èªªæ˜æ¡†ä¸Š
        const rect = formulaInfo.getBoundingClientRect();
        if (
          e.clientX < rect.left ||
          e.clientX > rect.right ||
          e.clientY < rect.top ||
          e.clientY > rect.bottom
        ) {
          isVisible = false;
          formulaInfo.classList.add("hidden");
        }
      });

      formulaInfo.addEventListener("mouseleave", function () {
        isVisible = false;
        formulaInfo.classList.add("hidden");
      });
    });
  </script>
</section>
