<!-- 頭部區域 - 包含導航欄 -->
<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
  <nav class="nav-blur px-6 py-3">
    <div class="max-w-content mx-auto flex items-center justify-between">
      <a href="#" class="flex items-center space-x-2">
        <div
          class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white"
        >
          <i class="fas fa-search"></i>
        </div>
        <span class="font-bold text-xl">#終結IPO制度暴力</span>
      </a>

      <div class="hidden md:flex items-center space-x-8">
        <a
          href="#overview"
          class="nav-link text-neutral-700 hover:text-primary transition-colors font-medium"
          >調查概述</a
        >
        <a
          href="#timeline"
          class="nav-link text-neutral-700 hover:text-primary transition-colors font-medium"
          >事件時間軸</a
        >
        <a
          href="#data"
          class="nav-link text-neutral-700 hover:text-primary transition-colors font-medium"
          >責任額數據</a
        >
        <a
          href="#impact"
          class="nav-link text-neutral-700 hover:text-primary transition-colors font-medium"
          >影響分析</a
        >
        <a
          href="#actions"
          class="nav-link text-neutral-700 hover:text-primary transition-colors font-medium"
          >檢舉範本</a
        >

        <button
          id="share-btn"
          class="p-3 rounded-full bg-primary text-white hover:bg-primary-dark transition-colors shadow-sm hover:shadow-md"
        >
          <i class="fas fa-share-alt"></i>
        </button>
      </div>

      <div class="flex items-center space-x-4">
        <!-- 手機版漢堡包按鈕 -->
        <button class="menu-toggle md:hidden relative group">
          <div
            class="w-12 h-12 rounded-2xl bg-white/95 backdrop-blur-md shadow-lg border border-neutral-200/50 flex items-center justify-center transition-all duration-300 group-hover:shadow-xl group-hover:scale-105 group-hover:border-primary/30"
          >
            <div class="w-6 h-6 flex flex-col justify-center items-center">
              <span
                class="hamburger-line block w-5 h-0.5 bg-gradient-to-r from-neutral-600 to-neutral-700 transition-all duration-300 ease-out group-hover:from-primary group-hover:to-primary-dark"
              ></span>
              <span
                class="hamburger-line block w-5 h-0.5 bg-gradient-to-r from-neutral-600 to-neutral-700 mt-1.5 transition-all duration-300 ease-out group-hover:from-primary group-hover:to-primary-dark"
              ></span>
              <span
                class="hamburger-line block w-5 h-0.5 bg-gradient-to-r from-neutral-600 to-neutral-700 mt-1.5 transition-all duration-300 ease-out group-hover:from-primary group-hover:to-primary-dark"
              ></span>
            </div>
          </div>
        </button>
      </div>
    </div>
  </nav>

  <!-- 手機版滑出菜單 -->
  <div class="mobile-menu fixed inset-0 z-[9999] hidden">
    <!-- 背景遮罩 -->
    <div
      class="menu-backdrop absolute inset-0 bg-gradient-to-br from-black/30 via-black/50 to-black/70 backdrop-blur-sm transition-opacity duration-500 opacity-0"
    ></div>

    <!-- 菜單面板 -->
    <div
      class="menu-panel absolute top-0 right-0 h-full w-96 max-w-[90vw] bg-white/98 backdrop-blur-xl shadow-2xl transform translate-x-full transition-transform duration-500 ease-out border-l border-neutral-200/50 overflow-hidden"
    >
      <!-- 菜單標頭 -->
      <div
        class="relative p-8 bg-gradient-to-br from-white to-neutral-50 border-b border-neutral-100"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <div
              class="w-10 h-10 bg-gradient-to-br from-primary to-primary-dark rounded-xl shadow-lg flex items-center justify-center"
            >
              <i class="fas fa-search text-white text-sm"></i>
            </div>
            <div>
              <span class="text-neutral-800 font-bold text-lg">導航菜單</span>
              <p class="text-xs text-neutral-500 mt-0.5">
                快速跳轉到感興趣的內容
              </p>
            </div>
          </div>
          <button
            class="menu-close w-10 h-10 rounded-xl bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-600 hover:text-neutral-800 transition-all duration-200 hover:scale-105"
          >
            <i class="fas fa-times text-sm"></i>
          </button>
        </div>
      </div>

      <!-- 菜單項目 -->
      <div
        class="p-6 space-y-1 overflow-y-auto"
        style="height: calc(100vh - 200px)"
      >
        <a
          href="#overview"
          class="menu-item group flex items-center p-5 rounded-2xl text-neutral-700 hover:bg-gradient-to-r hover:from-primary/8 hover:to-primary/4 hover:text-primary transition-all duration-300 hover:shadow-sm"
        >
          <div
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-50 border border-neutral-200 flex items-center justify-center mr-4 group-hover:border-primary/20 group-hover:from-primary/10 group-hover:to-primary/5 transition-all duration-300"
          >
            <i
              class="fas fa-file-alt text-neutral-500 group-hover:text-primary transition-colors duration-300"
            ></i>
          </div>
          <div class="flex-1">
            <span class="font-semibold text-base">調查概述</span>
            <p
              class="text-sm text-neutral-500 group-hover:text-primary/70 transition-colors duration-300"
            >
              深度報告核心內容
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-lg bg-neutral-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300"
          >
            <i
              class="fas fa-chevron-right text-xs text-neutral-400 group-hover:text-primary group-hover:translate-x-0.5 transition-all duration-300"
            ></i>
          </div>
        </a>

        <a
          href="#timeline"
          class="menu-item group flex items-center p-5 rounded-2xl text-neutral-700 hover:bg-gradient-to-r hover:from-primary/8 hover:to-primary/4 hover:text-primary transition-all duration-300 hover:shadow-sm"
        >
          <div
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-50 border border-neutral-200 flex items-center justify-center mr-4 group-hover:border-primary/20 group-hover:from-primary/10 group-hover:to-primary/5 transition-all duration-300"
          >
            <i
              class="fas fa-clock text-neutral-500 group-hover:text-primary transition-colors duration-300"
            ></i>
          </div>
          <div class="flex-1">
            <span class="font-semibold text-base">事件時間軸</span>
            <p
              class="text-sm text-neutral-500 group-hover:text-primary/70 transition-colors duration-300"
            >
              關鍵發展歷程
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-lg bg-neutral-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300"
          >
            <i
              class="fas fa-chevron-right text-xs text-neutral-400 group-hover:text-primary group-hover:translate-x-0.5 transition-all duration-300"
            ></i>
          </div>
        </a>

        <a
          href="#data"
          class="menu-item group flex items-center p-5 rounded-2xl text-neutral-700 hover:bg-gradient-to-r hover:from-primary/8 hover:to-primary/4 hover:text-primary transition-all duration-300 hover:shadow-sm"
        >
          <div
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-50 border border-neutral-200 flex items-center justify-center mr-4 group-hover:border-primary/20 group-hover:from-primary/10 group-hover:to-primary/5 transition-all duration-300"
          >
            <i
              class="fas fa-chart-bar text-neutral-500 group-hover:text-primary transition-colors duration-300"
            ></i>
          </div>
          <div class="flex-1">
            <span class="font-semibold text-base">責任額數據</span>
            <p
              class="text-sm text-neutral-500 group-hover:text-primary/70 transition-colors duration-300"
            >
              詳細數據分析
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-lg bg-neutral-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300"
          >
            <i
              class="fas fa-chevron-right text-xs text-neutral-400 group-hover:text-primary group-hover:translate-x-0.5 transition-all duration-300"
            ></i>
          </div>
        </a>

        <a
          href="#impact"
          class="menu-item group flex items-center p-5 rounded-2xl text-neutral-700 hover:bg-gradient-to-r hover:from-primary/8 hover:to-primary/4 hover:text-primary transition-all duration-300 hover:shadow-sm"
        >
          <div
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-50 border border-neutral-200 flex items-center justify-center mr-4 group-hover:border-primary/20 group-hover:from-primary/10 group-hover:to-primary/5 transition-all duration-300"
          >
            <i
              class="fas fa-exclamation-triangle text-neutral-500 group-hover:text-primary transition-colors duration-300"
            ></i>
          </div>
          <div class="flex-1">
            <span class="font-semibold text-base">影響分析</span>
            <p
              class="text-sm text-neutral-500 group-hover:text-primary/70 transition-colors duration-300"
            >
              多方影響評估
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-lg bg-neutral-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300"
          >
            <i
              class="fas fa-chevron-right text-xs text-neutral-400 group-hover:text-primary group-hover:translate-x-0.5 transition-all duration-300"
            ></i>
          </div>
        </a>

        <a
          href="#actions"
          class="menu-item group flex items-center p-5 rounded-2xl text-neutral-700 hover:bg-gradient-to-r hover:from-primary/8 hover:to-primary/4 hover:text-primary transition-all duration-300 hover:shadow-sm"
        >
          <div
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-neutral-100 to-neutral-50 border border-neutral-200 flex items-center justify-center mr-4 group-hover:border-primary/20 group-hover:from-primary/10 group-hover:to-primary/5 transition-all duration-300"
          >
            <i
              class="fas fa-file-signature text-neutral-500 group-hover:text-primary transition-colors duration-300"
            ></i>
          </div>
          <div class="flex-1">
            <span class="font-semibold text-base">檢舉範本</span>
            <p
              class="text-sm text-neutral-500 group-hover:text-primary/70 transition-colors duration-300"
            >
              實用檢舉工具
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-lg bg-neutral-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300"
          >
            <i
              class="fas fa-chevron-right text-xs text-neutral-400 group-hover:text-primary group-hover:translate-x-0.5 transition-all duration-300"
            ></i>
          </div>
        </a>
      </div>

      <!-- 菜單底部 -->
      <div
        class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-white to-neutral-50 border-t border-neutral-100"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-neutral-700">分享調查報告</p>
            <p class="text-xs text-neutral-500">讓更多人了解真相</p>
          </div>
          <button
            id="mobile-share-btn"
            class="w-14 h-14 rounded-2xl bg-gradient-to-br from-primary to-primary-dark text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center justify-center group"
          >
            <i
              class="fas fa-share-alt group-hover:scale-110 transition-transform duration-300"
            ></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Header JavaScript 功能 -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 防止重複初始化
    if (window.headerInitialized) {
      return;
    }
    window.headerInitialized = true;

    console.log("Header: 開始初始化...");

    // 導航列滑動效果
    const header = document.querySelector("header");
    const nav = document.querySelector("nav");
    let lastScrollTop = 0;

    function handleScroll() {
      const scrollTop =
        window.pageYOffset || document.documentElement.scrollTop;

      // 添加/移除滑動後的樣式
      if (scrollTop > 50) {
        nav.classList.add("scrolled");
        nav.style.backgroundColor = "rgba(255, 255, 255, 0.95)";
        nav.style.backdropFilter = "blur(10px)";
        nav.style.borderBottom = "1px solid rgba(0, 0, 0, 0.1)";
      } else {
        nav.classList.remove("scrolled");
        nav.style.backgroundColor = "rgba(255, 255, 255, 0.8)";
        nav.style.backdropFilter = "blur(5px)";
        nav.style.borderBottom = "none";
      }

      lastScrollTop = scrollTop;
    }

    // 節流函數優化性能
    let ticking = false;
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(handleScroll);
        ticking = true;
        setTimeout(() => {
          ticking = false;
        }, 16);
      }
    }

    if (nav) {
      window.addEventListener("scroll", requestTick);
    }

    // 漢堡包菜單功能 - 統一邏輯管理
    function initMobileMenu() {
      const menuToggle = document.querySelector(".menu-toggle");
      const mobileMenu = document.querySelector(".mobile-menu");
      const menuClose = document.querySelector(".menu-close");
      const menuItems = document.querySelectorAll(".menu-item");
      const menuPanel = document.querySelector(".menu-panel");
      const menuBackdrop = document.querySelector(".menu-backdrop");
      const hamburgerLines = document.querySelectorAll(".hamburger-line");

      if (!menuToggle || !mobileMenu || !menuPanel || !menuBackdrop) {
        console.log("Header: 選單元素未完全載入，稍後重試...");
        setTimeout(initMobileMenu, 500);
        return;
      }

      let isMenuOpen = false;

      // 開啟菜單
      function openMenu() {
        if (isMenuOpen) return;
        isMenuOpen = true;

        console.log("Header: 開啟選單");

        // 顯示選單容器
        mobileMenu.classList.remove("hidden");
        document.body.style.overflow = "hidden";

        // 漸顯背景遮罩
        setTimeout(() => {
          menuBackdrop.classList.remove("opacity-0");
          menuBackdrop.classList.add("opacity-100");
        }, 10);

        // 滑入菜單面板
        setTimeout(() => {
          menuPanel.style.transform = "translateX(0)";
        }, 10);

        // 漢堡包線條變形為X
        if (hamburgerLines.length >= 3) {
          hamburgerLines[0].style.transform =
            "rotate(45deg) translate(5px, 5px)";
          hamburgerLines[1].style.opacity = "0";
          hamburgerLines[2].style.transform =
            "rotate(-45deg) translate(7px, -6px)";
        }
      }

      // 關閉菜單
      function closeMenu() {
        if (!isMenuOpen) return;
        isMenuOpen = false;

        console.log("Header: 關閉選單");

        // 隱藏背景遮罩
        menuBackdrop.classList.remove("opacity-100");
        menuBackdrop.classList.add("opacity-0");

        // 滑出菜單面板
        menuPanel.style.transform = "translateX(100%)";

        // 恢復漢堡包線條
        if (hamburgerLines.length >= 3) {
          hamburgerLines[0].style.transform = "";
          hamburgerLines[1].style.opacity = "";
          hamburgerLines[2].style.transform = "";
        }

        // 延遲隱藏容器和恢復滾動
        setTimeout(() => {
          mobileMenu.classList.add("hidden");
          document.body.style.overflow = "";
        }, 500);
      }

      // 綁定事件
      if (menuToggle) {
        menuToggle.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          if (isMenuOpen) {
            closeMenu();
          } else {
            openMenu();
          }
        });
      }

      if (menuClose) {
        menuClose.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          closeMenu();
        });
      }

      // 點擊菜單項目後自動關閉
      menuItems.forEach((item) => {
        item.addEventListener("click", function () {
          setTimeout(closeMenu, 200);
        });
      });

      // 點擊背景遮罩關閉菜單
      if (menuBackdrop) {
        menuBackdrop.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();
          closeMenu();
        });
      }

      // ESC 鍵關閉菜單
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && isMenuOpen) {
          closeMenu();
        }
      });

      console.log("Header: 漢堡包選單初始化完成");
    }

    // 手機版分享按鈕功能
    function initMobileShareButton() {
      const mobileShareBtn = document.getElementById("mobile-share-btn");
      if (mobileShareBtn) {
        mobileShareBtn.addEventListener("click", function (e) {
          e.preventDefault();
          e.stopPropagation();

          // 觸發分享模態框
          if (
            window.showShareModal &&
            typeof window.showShareModal === "function"
          ) {
            window.showShareModal();
          } else if (
            window.shareModalControls &&
            typeof window.shareModalControls.showShareModal === "function"
          ) {
            window.shareModalControls.showShareModal();
          } else {
            console.log("Header: 分享功能尚未準備就緒");
          }
        });
      }
    }

    // 延遲初始化，確保DOM完全載入
    setTimeout(() => {
      initMobileMenu();
      initMobileShareButton();
    }, 100);

    console.log("Header: 初始化完成");
  });
</script>
