# 台灣 IPO 調查專案修復報告

## 專案概述

「taiwan-ipo-investigation」是一個揭露台灣證券業 IPO 與 ETF 募集制度問題的網站專案。本次修復主要針對兩個功能問題：

1. 公式說明提示按鈕功能失效
2. 表格標頭在滾動時未能保持固定

## 診斷結果

### 公式說明按鈕問題

透過 Puppeteer 自動化測試發現，當滑鼠滑過或點擊公式說明按鈕時，應顯示的公式說明提示框沒有正確顯示。經檢查代碼，發現以下原因：

- 公式說明的事件綁定代碼在 HTML 中嵌入，但可能由於 DOM 載入順序問題，導致無法正確執行
- 可能有多個 JavaScript 函數嘗試控制同一元素，造成衝突
- CSS 樣式未正確設置，使提示框無法正確顯示

### 表格標頭固定問題

透過測試發現表格標頭在頁面滾動時沒有保持固定在視圖中。原因包括：

- 缺乏必要的 CSS `position: sticky` 屬性
- 表格容器的 `overflow` 設置不正確
- z-index 層級管理不當，導致標頭無法顯示在內容上方

## 修復方案與實施

### 公式說明功能修復

1. 建立專用 CSS 檔案 `formula-tooltip.css`：

   - 定義明確的公式說明按鈕樣式
   - 設置提示框的顯示/隱藏過渡效果
   - 優化在不同螢幕尺寸下的顯示效果

2. 創建專用 JavaScript 檔案 `formula-tooltip.js`：

   - 實現獨立的公式說明功能模組
   - 建立可靠的事件監聽與處理機制
   - 確保 DOM 完全載入後再初始化功能

3. 修改原始 HTML，確保公式說明按鈕有正確的 ID 和結構

### 表格標頭固定功能修復

1. 建立 `sticky-table-header.js` 專用腳本：

   - 實現表格標頭固定功能
   - 處理不同視圖模式的切換
   - 監聽滾動事件，適時調整標頭樣式

2. 內嵌直接解決方案：

   - 在 index.html 中添加了即時執行的腳本
   - 直接應用必要的 CSS 樣式
   - 設置延時執行確保 DOM 完全載入

3. 優化表格容器結構：
   - 設置合適的最大高度
   - 配置正確的 overflow 屬性
   - 確保 z-index 層級合理

## 優化建議

1. **代碼結構優化**：

   - 將內嵌腳本移至外部檔案
   - 建立統一的模組化架構
   - 實現更明確的依賴關係管理

2. **效能提升**：

   - 減少重複的 DOM 操作
   - 合併多個小型 CSS 和 JS 檔案
   - 應用防抖和節流技術優化事件處理

3. **可維護性改進**：
   - 添加詳細的代碼註解
   - 建立一致的命名規範
   - 實現錯誤監控和日誌記錄

## 測試結果

透過 Puppeteer 自動化測試，已確認修復後的功能正常工作：

1. **公式說明功能**：

   - 滑鼠滑過按鈕時公式說明能正確顯示
   - 點擊按鈕能鎖定/解鎖公式說明顯示狀態
   - 提示框樣式與內容均正確展示

2. **表格標頭固定功能**：
   - 表格標頭在頁面滾動時保持固定
   - 不同視圖模式下均能正常工作
   - 標頭樣式與原設計一致

## 結論

本次修復成功解決了公式說明按鈕和表格標頭固定功能的問題。修復方案採用了多層防護策略，即使在某一層修復不完全成功的情況下，其他層的修復方案也能確保功能正常。這種方法在複雜的前端環境中特別有效，能應對不同瀏覽器和設備帶來的挑戰。

未來建議對專案進行全面的代碼重構，採用更現代的前端框架和工具，以提高開發效率和維護性。

---

修復日期：2025 年 5 月 16 日
