<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ­éœ²ç‡Ÿæ¥­å“¡è¡€æ±—IPO - å¯è¦–åŒ–å ±å‘Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Noto Sans TC", sans-serif;
        background-color: #f3f4f6;
      }
      .hero-section {
        background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
          url("https://placehold.co/1200x400/4A5568/E2E8F0?text=é‡‘èå¸‚å ´è¿·éœ§");
        background-size: cover;
        background-position: center;
      }
      .stat-card {
        background-color: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .table-loss {
        color: #22c55e;
        font-weight: 600;
      }
      .table-gain {
        color: #ef4444;
        font-weight: 600;
      }
      .table-neutral {
        color: #6b7280;
      }
      th,
      td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }
      thead th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #374151;
      }
      .chart-container {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        position: relative;
        height: 400px;
      }
      .section-title {
        font-size: 1.875rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #d1d5db;
      }
      .content-box {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        margin-bottom: 3rem;
      }
      .simulation-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
      }
      .simulation-button {
        background-color: #ef4444;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 600;
        transition: background-color 0.3s ease;
      }
      .simulation-button:hover {
        background-color: #dc2626;
      }
      .simulation-result-item {
        margin-bottom: 0.75rem;
        font-size: 1rem;
      }
      .simulation-result-item strong {
        color: #1f2937;
      }
      .loss-emphasis {
        color: #22c55e;
        font-weight: bold;
        font-size: 1.1em;
      }
      .gain-emphasis {
        color: #ef4444;
        font-weight: bold;
        font-size: 1.1em;
      }
      .pressure-quote {
        font-style: italic;
        color: #4b5563;
        border-left: 4px solid #ef4444;
        padding-left: 1rem;
        margin: 1rem 0;
        background-color: #fef2f2;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        border-radius: 0.25rem;
      }
      .broker-monologue {
        font-style: italic;
        color: #71717a;
        border-left: 4px solid #facc15;
        padding-left: 1rem;
        margin: 1rem 0;
        background-color: #fffbeb;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        border-radius: 0.25rem;
      }
      .forced-choice-options p {
        margin-bottom: 0.5rem;
        padding: 0.5rem;
        border: 1px dashed #d1d5db;
        border-radius: 0.25rem;
        background-color: #f9fafb;
      }
      .broker-statement-table {
        font-size: 0.875rem;
        line-height: 1.25rem;
      }
      .broker-statement-table th,
      .broker-statement-table td {
        padding: 0.5rem;
      }

      @keyframes sad-pulse-animation {
        0% {
          color: #ef4444;
          opacity: 0.7;
          transform: scale(1);
        }
        50% {
          color: #dc2626;
          opacity: 1;
          transform: scale(1.03);
        }
        100% {
          color: #ef4444;
          opacity: 0.7;
          transform: scale(1);
        }
      }
      .sad-text-effect {
        animation: sad-pulse-animation 1.8s infinite ease-in-out;
      }
      .final-loss-figure {
        font-size: 1.5rem;
        font-weight: bold;
      }
      .experience-button {
        background-color: #8b5cf6;
        color: white;
        padding: 1rem 2rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 1.25rem;
        transition: all 0.3s ease;
        display: block;
        width: 100%;
        text-align: center;
        margin: 1.5rem 0;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .experience-button:hover {
        background-color: #7c3aed;
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .experience-button:active {
        transform: translateY(0);
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.5s ease forwards;
      }
      .chart-wrapper {
        width: 100%;
        height: 100%;
        max-height: 360px;
        position: relative;
      }
    </style>
  </head>
  <body class="antialiased">
    <section
      class="hero-section text-white py-16 px-4 sm:px-6 lg:px-8 rounded-b-xl shadow-lg"
    >
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl sm:text-5xl font-bold mb-4">æ­éœ²ç‡Ÿæ¥­å“¡è¡€æ±—IPO</h1>
        <p class="text-xl sm:text-2xl mb-2">
          è²¬ä»»é¡åˆ¶åº¦ä¸‹çš„æŠ•è³‡æ‚²æ­Œèˆ‡å¸‚å ´ç¾å½¢è¨˜
        </p>
        <p class="text-md text-gray-200">
          æ•¸æ“šæ­ç¤ºå£“åŠ›ä¸‹çš„æ½›åœ¨è™§æï¼Œæ­£è¦–å¾æ¥­äººå“¡å›°å¢ƒ
        </p>
      </div>
    </section>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
      <section id="introduction" class="content-box">
        <h2 class="section-title">åˆ¶åº¦èƒŒæ™¯ï¼šä½•è¬‚ã€Œç‡Ÿæ¥­å“¡è¡€æ±—è²¬ä»»é¡ã€ï¼Ÿ</h2>
        <div class="space-y-3 text-gray-700 leading-relaxed">
          <p>
            å°ç£é‡‘èå¸‚å ´ï¼Œå°¤å…¶ETFç™¼è¡Œç†±æ½®ä¸­ï¼Œã€Œç‡Ÿæ¥­å“¡è²¬ä»»é¡ã€å¼•ç™¼å»£æ³›è¨è«–ã€‚æ­¤åˆ¶åº¦è¦æ±‚é‡‘èæ©Ÿæ§‹ç‡Ÿæ¥­å“¡é”æˆIPOæˆ–ETFçš„éŠ·å”®é…é¡ã€‚ç‚ºé”æ¨™ï¼Œç‡Ÿæ¥­å“¡æ‰¿å—å·¨å¤§å£“åŠ›ï¼Œç”šè‡³å¯èƒ½è¢«è¿«<strong
              class="text-red-600"
              >è‡ªæè…°åŒ…èªè³¼</strong
            >ï¼Œæ‰¿æ“”æ½›åœ¨è²¡å‹™é¢¨éšªã€‚
          </p>
          <p>
            æ­¤åˆ¶åº¦ä¸åƒ…å½±éŸ¿ç‡Ÿæ¥­å“¡ï¼Œäº¦å¯èƒ½å°è‡´äººç‚ºéœ€æ±‚ã€å¸‚å ´æ³¢å‹•åŠ åŠ‡ã€ç”¢å“åŒè³ªåŒ–åŠéŠ·å”®åˆè¦é¢¨éšªç­‰å•é¡Œã€‚
          </p>
        </div>
      </section>

      <section id="key-findings" class="content-box">
        <h2 class="section-title">é—œéµç™¼ç¾ï¼šä¸èƒ½èªªçš„ç§˜å¯†</h2>
        <div class="space-y-2 text-gray-700 leading-relaxed">
          <p>
            <strong class="text-red-700">ç³»çµ±æ€§è¢«æ¬ºå£“ï¼š</strong
            >ç‡Ÿæ¥­å“¡æ™®éæ„Ÿå—é«˜åº¦å£“åŠ›ï¼Œå•é¡Œå·²éå€‹æ¡ˆã€‚
          </p>
          <p>
            <strong class="text-red-700">ç®¡ç†æ‰‹æ®µå¸¸æ…‹åŒ–ï¼š</strong
            >ä¸»ç®¡æ…£ç”¨æƒ…ç·’å‹’ç´¢ã€å¨è„…æ‰£ç¸¾æ•ˆç­‰æ–¹å¼æ–½å£“ã€‚
          </p>
          <p>
            <strong class="text-red-700">ç„¡å¥ˆçš„é¸æ“‡ï¼š</strong
            >å¤šæ•¸ç‡Ÿæ¥­å“¡è¢«è¿«è‡ªè³¼ï¼Œç”šè‡³è²¸æ¬¾è²·å–®ï¼Œå½¢æˆæƒ¡æ€§å¾ªç’°ã€‚
          </p>
          <p>
            <strong class="text-red-700">å¿ƒç†å¥åº·è­¦è¨Šï¼š</strong
            >å¤±çœ ã€ç„¦æ…®ç­‰å¿ƒç†å•é¡Œæ™®éï¼Œéƒ¨åˆ†éœ€é†«ç™‚å”åŠ©ã€‚
          </p>
        </div>
      </section>

      <section id="broker-statement-section" class="content-box">
        <h2 class="section-title">
          è­¦ç¤ºï¼šç‡Ÿæ¥­å“¡è¢«è¿«æ‰¿æ“”ä¹‹æ½›åœ¨è™§æ (æ¨¡æ“¬å…§éƒ¨æª¢è¨å–®)
        </h2>
        <p class="text-gray-600 mb-4">
          ä»¥ä¸‹æ¨¡æ“¬å±•ç¤ºåœ¨è«é ˆæœ‰çš„è²¬ä»»é¡å£“åŠ›ä¸‹ï¼Œç‡Ÿæ¥­å“¡å¯èƒ½è¢«è¿«å‹•ç”¨å¤§é¡è³‡é‡‘ï¼ˆæ­¤è™•æ¨¡æ“¬æ¯æª”éš¨æ©Ÿ
          <strong class="text-red-600">30è¬è‡³600è¬</strong>
          å…ƒï¼‰èªè³¼å¤šæª”IPOã€‚å‡è¨­çš†æ–¼ä¸Šå¸‚é¦–æ—¥ä»¥<strong class="text-red-500"
            >æœ€ä½åƒ¹</strong
          >å«æ·šè³£å‡ºï¼Œé€™ä»½ã€Œå…§éƒ¨æª¢è¨å–®ã€æ­ç¤ºäº†é©šäººçš„æ½›åœ¨è™§æã€‚
        </p>
        <div class="overflow-x-auto">
          <table
            class="min-w-full divide-y divide-gray-200 broker-statement-table"
          >
            <thead class="bg-gray-100">
              <tr>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  è‚¡ç¥¨åç¨±
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  å‹Ÿé›†åƒ¹ (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  é¦–æ—¥æœ€ä½ (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  æ¨¡æ“¬èªè³¼é¡ (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  å¯è³¼è‚¡æ•¸
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  è²·å…¥æ‰‹çºŒè²» (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  è³£å‡ºæ‰‹çºŒè²»+ç¨… (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  å¯¦éš›æˆæœ¬ (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  è³£å‡ºåƒ¹å€¼ (å…ƒ)
                </th>
                <th
                  class="px-2 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider"
                >
                  å–®æª”è™§æ (å…ƒ)
                </th>
              </tr>
            </thead>
            <tbody
              id="broker-loss-statement-body"
              class="bg-white divide-y divide-gray-200"
            >
              <tr>
                <td colspan="10" class="text-center p-4 text-gray-500">
                  éšŠé•·å–®è³‡æ–™ç”Ÿæˆä¸­...
                </td>
              </tr>
            </tbody>
            <tfoot class="bg-gray-100">
              <tr>
                <td
                  colspan="9"
                  class="px-2 py-2 text-right text-sm font-semibold text-gray-700"
                >
                  ç¸½è¨ˆæ½›åœ¨è™§æï¼š
                </td>
                <td
                  id="broker-total-loss"
                  class="px-2 py-2 text-right text-sm font-bold text-green-600"
                >
                  0 å…ƒ
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
        <p class="mt-4 text-xs text-gray-500">
          *
          æ­¤ç‚ºè™›æ§‹çš„å…§éƒ¨æª¢è¨å–®ï¼Œæ—¨åœ¨æ­ç¤ºåˆ¶åº¦æ€§é¢¨éšªã€‚å¯¦éš›è™§æå°‡ä¾å€‹åˆ¥IPOè¡¨ç¾åŠè¢«è¿«èªè³¼é‡‘é¡è€Œç•°ã€‚è™§æä»¥ç¶ è‰²è¡¨ç¤º(ç´…æ¼²ç¶ è·Œ)ã€‚
        </p>
      </section>

      <section id="simulation-section" class="content-box">
        <h2 class="section-title">ç‡Ÿæ¥­å“¡å£“åŠ›æƒ…å¢ƒæ¨¡æ“¬</h2>
        <p class="text-gray-600 mb-2">
          ã€Œå®¢æˆ¶æ²’è²·å°±è‡ªå·±è²·ï¼ã€ã€ã€Œä½ ä¸åšï¼Œå¾Œé¢å¤šçš„æ˜¯äººæƒ³åšï¼ã€...
          é€™äº›è©±èªæ˜¯å¦ä¼¼æ›¾ç›¸è­˜ï¼Ÿ
        </p>
        <p class="text-gray-600 mb-4">
          è¦ªèº«é«”é©—ç‡Ÿæ¥­å“¡åœ¨ä¸»ç®¡æ˜ç¤ºæš—ç¤ºã€æ¥­ç¸¾å£“åŠ›ä¸‹ï¼Œè¢«è¿«æ‰¿æ“”è²¬ä»»é¡çš„å…¸å‹æƒ…å¢ƒã€‚é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè¦ªè‡ªé«”é©—è‹¥è¢«è¿«éš¨æ©Ÿèªè³¼IPOï¼Œä¸¦æ–¼ä¸Šå¸‚é¦–æ—¥æˆ–å‡¹å–®å¾Œä»¥æœ€ä½åƒ¹å«æ·šè³£å‡ºï¼Œå¯èƒ½é¢è‡¨çš„è²¡å‹™èˆ‡å¿ƒç†å£“åŠ›ã€‚
        </p>

        <button id="runSimulationBtn" class="experience-button">
          ç›´æ¥é«”é©—ã€Œè²¬ä»»é¡å£“åŠ›ã€
        </button>

        <div
          id="simulationResult"
          class="mt-6 p-4 border border-gray-200 rounded-md bg-gray-50 hidden"
        >
          <h3 class="text-xl font-semibold text-gray-800 mb-3">
            å£“åŠ›é‹ä¸‹çš„æ¨¡æ“¬çµæœ:
          </h3>
        </div>
      </section>

      <section id="investigation-summary" class="content-box">
        <h2 class="section-title">ã€Œè¡€æ±—è²¬ä»»é¡ã€èª¿æŸ¥æ‘˜è¦</h2>
        <div class="space-y-3 text-gray-700 leading-relaxed">
          <p>
            <strong>èª¿æŸ¥èƒŒæ™¯ï¼š</strong
            >å½™æ•´å¤šæ–¹ç‡Ÿæ¥­å“¡çœŸå¯¦ç¶“æ­·ï¼Œæ­ç¤ºè²¬ä»»é¡åˆ¶åº¦å¦‚ä½•å¾æ¿€å‹µè®Šè³ªç‚ºå‰å‰Šã€‚
          </p>
          <ul class="list-disc list-inside space-y-1 pl-4 text-sm">
            <li>
              <strong>è¢«è¿«è‡ªè³¼ï¼š</strong
              >ä¸»ç®¡æ˜ç¤ºæˆ–æš—ç¤ºã€Œè‡ªå·±æƒ³è¾¦æ³•ã€ï¼Œç”šè‡³é¼“å‹µè²¸æ¬¾é”æ¨™ã€‚
            </li>
            <li>
              <strong>å¨è„…æåš‡ï¼š</strong
              >ã€Œä¸åšå°±æ»¾ã€ã€ã€Œå®¢æˆ¶è½‰èµ°ã€ç­‰è¨€èªæˆç‚ºç®¡ç†æ—¥å¸¸ã€‚
            </li>
            <li>
              <strong>æƒ¡æ€§å¾ªç’°ï¼š</strong
              >ç‚ºç²å–ã€Œå›å–®ã€ï¼Œåˆ¸å•†å¼·è¿«ç‡Ÿæ¥­å“¡é”æ¨™ï¼Œå£“åŠ›å±¤å±¤è½‰å«ã€‚
            </li>
            <li>
              <strong>åˆ¶åº¦ç¼ºå¤±ï¼š</strong
              >è²¬ä»»é¡ç¼ºä¹æ³•æºï¼Œæ“ä½œä¸é€æ˜ï¼Œçæ‡²æ¨™æº–æ¨¡ç³Šã€‚
            </li>
          </ul>
          <h3 class="text-lg font-semibold text-gray-800 mt-3 mb-1">
            ç‡Ÿæ¥­å“¡å¿ƒè²ï¼šã€Œåªæƒ³è¢«ç•¶äººçœ‹ã€
          </h3>
          <ul class="list-disc list-inside space-y-1 pl-4 text-sm">
            <li>æƒ…ç·’å‹’ç´¢ã€å…¬é–‹ç¾è¾±ã€åˆ©ç›Šåˆ†é…ä¸å‡ã€å¿ƒç†å¥åº·å±æ©Ÿé »å‚³ã€‚</li>
            <li>
              ã€Œä¸æ˜¯åœ¨ç­‰å¾…æ”¹è®Šï¼Œæˆ‘å€‘å°±æ˜¯æ”¹è®Šçš„åŠ›é‡ã€â€”â€”è¶Šä¾†è¶Šå¤šç‡Ÿæ¥­å“¡å‹‡æ•¢ç™¼è²ã€‚
            </li>
          </ul>
        </div>
      </section>

      <section id="key-stats" class="mb-12">
        <h2 class="text-3xl font-semibold text-gray-800 mb-6 text-center">
          æ ¸å¿ƒæ•¸æ“šç¸½è¦½
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="stat-card text-center">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              ä¸Šå¸‚ç•¶æ—¥ç ´ç™¼æ©Ÿç‡
            </h3>
            <p
              id="stats-breakeven-day1"
              class="text-4xl font-bold text-green-600"
            >
              --%
            </p>
            <p class="text-sm text-gray-500">IPOåƒ¹æ ¼ä½æ–¼å‹Ÿé›†åƒ¹</p>
          </div>
          <div class="stat-card text-center">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              ä¸€å€‹æœˆå¾Œç ´ç™¼æ©Ÿç‡
            </h3>
            <p
              id="stats-breakeven-month1"
              class="text-4xl font-bold text-green-600"
            >
              --%
            </p>
            <p class="text-sm text-gray-500">IPOåƒ¹æ ¼ä½æ–¼å‹Ÿé›†åƒ¹</p>
          </div>
          <div class="stat-card text-center">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              å¹³å‡ç•¶æ—¥æ½›è™§(ç ´ç™¼è‚¡)
            </h3>
            <p
              id="stats-avg-loss-day1"
              class="text-4xl font-bold text-green-600"
            >
              --%
            </p>
            <p class="text-sm text-gray-500">è‹¥ä¸Šå¸‚ç•¶æ—¥ç ´ç™¼</p>
          </div>
          <div class="stat-card text-center">
            <h3 class="text-xl font-semibold text-gray-700 mb-2">
              å¹³å‡æœˆå¾Œæ½›è™§(ç ´ç™¼è‚¡)
            </h3>
            <p
              id="stats-avg-loss-month1"
              class="text-4xl font-bold text-green-600"
            >
              --%
            </p>
            <p class="text-sm text-gray-500">è‹¥ä¸€å€‹æœˆå¾Œç ´ç™¼</p>
          </div>
        </div>
      </section>

      <section id="data-table-section" class="content-box">
        <h2 class="section-title">IPO è©³ç´°æ•¸æ“šèˆ‡æ½›åœ¨è™§æåˆ†æ</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  è‚¡ç¥¨åç¨±
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  ä¸Šå¸‚æ—¥
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  å‹Ÿé›†åƒ¹æ ¼(å…ƒ)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  æ›ç‰Œç•¶å¤©æœ€ä½(å…ƒ)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  æ›ç‰Œæœˆå¾Œæœ€ä½(å…ƒ)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  ç•¶æ—¥æ½›åœ¨è™§æ(å…ƒ/è‚¡)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  ç•¶æ—¥æ½›åœ¨è™§æç‡(%)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  æœˆå¾Œæ½›åœ¨è™§æ(å…ƒ/è‚¡)
                </th>
                <th
                  scope="col"
                  class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                >
                  æœˆå¾Œæ½›åœ¨è™§æç‡(%)
                </th>
              </tr>
            </thead>
            <tbody
              id="ipo-table-body"
              class="divide-y divide-gray-200 bg-white"
            >
              <tr>
                <td colspan="9" class="text-center p-8 text-gray-500">
                  IPO è³‡æ–™è¼‰å…¥ä¸­...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="mt-4 text-xs text-gray-500">
          *
          æ½›åœ¨è™§ææ˜¯ä»¥å‹Ÿé›†åƒ¹èªè³¼ï¼Œæ–¼ç•¶æ—¥æˆ–ä¸€å€‹æœˆå…§æœ€ä½é»è³£å‡ºè¨ˆç®—çš„æœ€å¤§å¯èƒ½æå¤±ã€‚ç´…æ¼²ç¶ è·Œï¼šæ­£å€¼é¡¯ç¤ºç‚ºç¶ è‰²(è·Œ)ï¼Œè² å€¼é¡¯ç¤ºç‚ºç´…è‰²(æ¼²)ã€‚
        </p>
      </section>

      <section id="charts-section" class="mb-12">
        <h2 class="text-3xl font-semibold text-gray-800 mb-6 text-center">
          è¦–è¦ºåŒ–åœ–è¡¨åˆ†æ
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="chart-container">
            <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">
              IPO ç ´ç™¼æ©Ÿç‡åˆ†æ
            </h3>
            <div class="chart-wrapper">
              <canvas id="breakevenPieChart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">
              ä¸€å€‹æœˆå¾Œæ½›åœ¨å ±é…¬ç‡åˆ†ä½ˆ
            </h3>
            <div class="chart-wrapper">
              <canvas id="lossDistributionBarChart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <section id="market-disruption" class="content-box">
        <h2 class="section-title">è²¬ä»»é¡åˆ¶åº¦å¦‚ä½•æ“¾äº‚å¸‚å ´ï¼Ÿ</h2>
        <div class="space-y-3 text-gray-700 leading-relaxed">
          <p>
            ç‡Ÿæ¥­å“¡IPOè²¬ä»»é¡åˆ¶åº¦ï¼Œé™¤å°å¾æ¥­äººå“¡é€ æˆå£“åŠ›ï¼Œå…¶å°æ•´é«”å¸‚å ´çš„æ½›åœ¨å½±éŸ¿äº¦ä¸å®¹å¿½è¦–ï¼šæ‰­æ›²ä¾›éœ€ã€ä¸Šå¸‚åˆæœŸä¸ç©©å®šã€è³‡æºéŒ¯é…èˆ‡ç”¢å“åŒè³ªåŒ–ã€æå®³æŠ•è³‡è€…ä¿¡ä»»ã€ä»¥åŠå¼•ç™¼é“å¾·é¢¨éšªèˆ‡åˆè¦å£“åŠ›ã€‚
          </p>
          <p>
            é•·é ä¾†çœ‹ï¼Œæ­¤åˆ¶åº¦è‹¥ç„¡é©ç•¶è¦ç¯„ï¼Œå¯èƒ½ä¾µè•å¸‚å ´å¥åº·ï¼Œå°ç›£ç†äº¦å¸¶ä¾†æŒ‘æˆ°ã€‚
          </p>
        </div>
      </section>

      <footer class="text-center py-8 mt-8 border-t border-gray-300">
        <p class="text-gray-700">
          &copy; <span id="currentYear"></span> IPOè¡€æ±—è²¬ä»»é¡è§€å¯Ÿå ±å‘Š.
          è³‡æ–™åƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ã€‚
        </p>
        <p class="text-sm text-gray-500 mt-1">
          æœŸæœ›é€éæ•¸æ“šæ­éœ²ï¼Œå–šèµ·å°å¾æ¥­äººå“¡è™•å¢ƒèˆ‡å¸‚å ´å¥åº·çš„é‡è¦–ã€‚
        </p>
      </footer>
    </main>

    <script>
      // --- Global Variables ---
      let allIpoData = [];
      let breakevenPieChartInstance = null;
      let lossDistributionBarChartInstance = null;
      const CSV_FILE_PATH = "IPO-æœ€ä½åƒ¹æ ¼.csv";

      const EXTENDED_PRESSURE_QUOTES = [
        "é€™è²¬ä»»é¡ä¸é«˜å•¦ï¼Œå¤§å®¶éƒ½åšå¾—åˆ°äº†ï¼Œå°±å·®ä½ äº†",
        "ä½ é€™æ¨£å¹´çµ‚å¯èƒ½ä¸ä¿å–”",
        "éŒ¢è‡ªå·±æº–å‚™å¥½ï¼Œå¿…è¦çš„è©±å°±ä¿¡è²¸ä¸€ä¸‹ï¼Œä¸ç„¶é€™å­£æ€éº¼éï¼Ÿ",
        "æŸæŸä¸Šæ¬¡é”ä¸åˆ°å°±æ˜¯å› ç‚ºä¸å¤ åŠªåŠ›ï¼Œäººå®¶XXå°±è‡ªå·±è²·äº† 300 è¬ï¼Œä½ å€‘é€£ä¸€åŠéƒ½ä¸åˆ°ï¼Œæ˜¯æ€æ¨£ï¼Ÿ",
        "ä½ å€‘ä¸æƒ³åšå°±è¬›ï¼Œæˆ‘å¯ä»¥å«æ–°äººä¾†é ‚ï¼Œç¾åœ¨ä¸€å †äººæ¶é€™å€‹ä½ç½®",
        "æ²’åšåˆ°ï¼Œå°ä¸èµ·å…¶ä»–æœ‰åšåˆ°çš„åŒäº‹ï¼Œæ‰€ä»¥è¦ç§»è½‰ä½ çš„å®¢æˆ¶è£œå„Ÿçµ¦å…¶ä»–äºº",
        "IPOæœªé”æ¨™å°±æ˜¯æ‹¿è³‡æºä¸åšäº‹ï¼Œ0%è·Ÿ99%ä¸€æ¨£æ˜¯éƒ½æœªé”æ¨™ï¼Œæœªé”100%å°±æŠ½èµ°ä½ çš„å‰äº”å¤§å®¢æˆ¶",
        "å…¶ä»–äººéƒ½åšå¾—åˆ°ï¼Œä½ ç‚ºä»€éº¼åšä¸åˆ°ï¼Œé‚£ä½ è¦æª¢è¨è‡ªå·±çš„å•é¡Œå˜›ï¼",
        "æˆ‘æ²’æœ‰è¦ä½ è²·ï¼æˆ‘è¦ä½ å»è¡ŒéŠ·ï¼",
        "é€£30è¬éƒ½æ²’æœ‰è¾¦æ³•è‡ªå·±åšIPO è¦æˆ‘å€Ÿä½ éŒ¢å—ï¼Ÿ",
        "æˆ‘ä¸ç›¸ä¿¡ä½ IPOé€£10è¬éƒ½é¨™ä¸åˆ°ï¼Œæ‹¿è‘—ä½ ç‡Ÿæ¥­å“¡çš„åç‰‡æœƒé¨™ä¸åˆ°10å—ï¼Ÿå¦‚æœé¨™ä¸åˆ°ï¼Œè¡¨ç¤ºé€™å€‹è¡Œæ¥­ä¸é©åˆä½ ï¼Œè«‹ä½ å¯ä»¥è€ƒæ…®é›¢é–‹",
        "å…¬å¸å°±æ˜¯è¢«ä½ å€‘æ‹–ç´¯çš„",
        "å…¬å¸ä¸é¤Šå†—å“¡",
        "åšä¸åˆ°å°±ç§»è½‰å®¢æˆ¶",
        "ä½ æ²’åšåˆ°çš„è©±ï¼Œå·¥ä½œé‚„è¦ä¸è¦",
        "ä½¿å‘½å¿…é”",
        "æ¥­å‹™é ˜çé‡‘ï¼Œå°±è©²è¦åšåˆ°å…¬å¸çš„ä»»å‹™ï¼ŒIPoæ˜¯å…¬å¸çš„é‡è¦ä»»å‹™ï¼Œè¦æƒ³è¾¦æ³•é”æˆ. å®¢æˆ¶é—œä¿‚å¥½ï¼Œå°±æ‹œè¨—å®¢æˆ¶è²·.åæ­£å°±æ˜¯è¦é”åˆ°ç›®æ¨™",
        "é€™æª”è²¬ä»»é¡æ²’åšåˆ°ï¼Œè¦è£œåœ¨ä¸‹ä¸€æª”",
        "åšä¸åˆ°å°±è¦æª¢è¨ç‚ºä»€éº¼åˆ¥äººåšå¾—åˆ°ä½ åšä¸åˆ°ï¼Ÿ",
        "å¦³è£™å­ç©¿å¾—æ¯”åˆ¥äººçŸ­ï¼Œè²¬ä»»é¡è·Ÿå…¶ä»–ç”·ç”Ÿä¸€æ¨£ä¸è¦ºå¾—æ„§ç–šå—",
        "ä½ æ˜¯å¥³ç”Ÿè¦æœƒåˆ©ç”¨è‡ªå·±å„ªå‹¢",
        "å¥³ç”Ÿæ€éº¼å¯èƒ½è³£ä¸å‡ºå»æ˜¯å¦³è¦ä¸è¦è€Œå·²ä½ çŸ¥é“æ–¹æ³•çš„",
        "ä¸Šé¢å£“ä¸‹ä¾†çš„ç›®æ¨™ï¼Œæˆ‘ä¸ç®¡ä½ ç”¨ä»€éº¼æ–¹æ³•ï¼Œä¸€å®šè¦é”åˆ°ï¼",
        "å®¢æˆ¶ä¸è²·ï¼Ÿé‚£ä½ å°±è‡ªå·±æƒ³è¾¦æ³•è™•ç†æ‰é€™äº›é¡åº¦ï¼Œä¸ç„¶å½±éŸ¿åˆ°åœ˜éšŠç¸¾æ•ˆï¼Œä½ çŸ¥é“å¾Œæœ",
        "è½èªªéš”å£çµ„çš„æŸæŸæŸï¼Œé€™æ¬¡åˆè‡ªå·±æè…°åŒ…äº†ï¼Œå¹´è¼•äººè¦å¤šå­¸ç¿’å•Šï¼",
        "é€™æ˜¯æ©Ÿæœƒï¼Œå…¬å¸çµ¦çš„è³‡æºï¼Œè¦å¥½å¥½æŠŠæ¡ï¼Œä¸è¦ä¸è­˜æŠ¬èˆ‰ï¼",
        "è½å¯¦callå®¢ï¼Œç¸½å…¬å¸è¿½è¹¤æ¯ä½åŒä»çš„é€²åº¦",
        "é”500è¬ä¸è¿½è¹¤",
        "é‡å°è½å¾ŒåŒä»ï¼Œå®¢æˆ¶åå–®ç§»è½‰",
        "é©ç•¶äººåŠ›èª¿æ•´",
        "åšä¸åˆ°å°±å›å®¶ç¡è¦º",
        "é”ä¸åˆ°ç›®æ¨™å°±æŠ½èµ°å®¢æˆ¶ï¼›è®Šç›¸è¦æ±‚åŠ ç­",
      ];

      const BROKER_INNER_MONOLOGUES = [
        "èªªçœŸçš„ï¼Œæˆ‘å·²ç¶“å¾ˆä¹…æ²’æœ‰è¦ºå¾—è‡ªå·±æ˜¯å€‹æ­£å¸¸å·¥ä½œçš„äººäº†...æˆ‘å€‘åªæ˜¯å¸Œæœ›é€™å€‹è¡Œæ¥­èƒ½æŠŠäººç•¶äººçœ‹ï¼Œè€Œä¸æ˜¯ä¸€å€‹å¯ä»¥éš¨æ™‚è£œä¸Šè²¬ä»»é¡çš„æ•¸å­—ç”¢å‡ºæ©Ÿå™¨ã€‚",
        "æˆ‘æƒ³å¥½å¥½å·¥ä½œï¼Œä¸æƒ³é ä¿¡è²¸ç”Ÿå­˜ï¼›æˆ‘æƒ³è¢«ç•¶ä½œäººçœ‹ï¼Œè€Œä¸æ˜¯ä¸€å€‹è¢«é€¼è²·å–®çš„æ¥­ç¸¾å·¥å…·ã€‚",
        "æ¯æ¬¡IPOä¾†çš„æ™‚å€™ï¼Œå¤§å®¶éƒ½è¦å…ˆç¢ºèªè‡ªå·±æº–å‚™äº†å¤šå°‘éŒ¢ï¼Œä¸æ˜¯å¹«å®¢æˆ¶é¸å¥½ç”¢å“ï¼Œè€Œæ˜¯å…ˆç¢ºä¿è‡ªå·±å¯ä»¥è£œå¤šå°‘æ´ã€‚",
        "ä½ å€‘çœ‹åˆ°çš„æ˜¯å›å–®è·Ÿç¸½éŠ·æ•¸å­—ï¼Œä½†ä½ å€‘æœ‰çœ‹åˆ°æˆ‘å€‘æ¯å¤©ç‚ºäº†é‚£äº›æ•¸å­—ï¼Œå£“åŠ›å¤§åˆ°åƒä¸ä¸‹ç¡ä¸è‘—çš„æ¨£å­å—ï¼Ÿ",
        "æˆ‘é ˜$30,000çš„è–ªæ°´ï¼Œæ€éº¼æˆ‘ä¸è³£IPOå°±æ¬ ä½ 50è¬äº†ï¼Ÿï¼Ÿé€™æ˜¯è­‰åˆ¸é‚„æ˜¯é»‘é“ï¼Œæ¯å€‹æœˆéƒ½ä¾†è·Ÿæˆ‘æ”¶ä¿è­·è²»...",
        "æˆ‘å€‘è–ªæ°´å¾ˆå°‘ï¼Œå¹³å¸¸äº‹å‹™å·¥ä½œä¹Ÿæ˜¯èŠ±é«”åŠ›èŠ±ç²¾åŠ›è³ºéŒ¢ä¾†çš„ï¼æˆ‘æ˜¯ä¾†è³ºéŒ¢çš„ï¼ä¸æ˜¯ä¾†è²·å·¥ä½œçš„ï¼",
        "æˆ‘å¾æ¥­30å¹¾å¹´ï¼Œç¬¬ä¸€æ¬¡æ„Ÿè¦ºè‡ªå·±æ˜¯è©é¨™é›†åœ˜...",
        "æ‹œè¨— æˆ‘å€‘ä¸æ˜¯24å°æ™‚å·¥ä½œæ©Ÿå™¨äººèª’ï¼Œç„¡æ™‚ç„¡åˆ»éƒ½åœ¨æƒ…ç·’å‹’ç´¢...",
        "æ¯å¤©éœ€è¦åƒè—¥ç¡è¦º,ææ…Œç„¦æ…®çš„æƒ…ç·’æ™‚å¸¸ä¼´éš¨ï¼Œæˆ‘çŸ¥é“æƒ…ç·’ç”Ÿç—…äº†ï¼Œè­‰åˆ¸æ¥­ä¹Ÿç”Ÿç—…äº†...",
        "è³ºåˆ°çš„éŒ¢éƒ½æ‹¿å»è²·éŠ€è¡ŒIPOå’ŒåŸºé‡‘äº†ï¼Œè‚¡å¸‚å¤§è·Œå…¨éƒ½å¥—ç‰¢äº†",
        "çœ‹ä¼¼å…‰é®®äº®éº—çš„è­‰åˆ¸ç‡Ÿæ¥­å“¡ï¼Œå¥½åƒè³ºå¾ˆå¤šï¼Œå¯¦å‰‡è™§ä¸å°‘ï¼Œæˆ‘å€‘æœ‰è‹¦é›£è¨€...",
        "æˆ‘æ˜¯ä¾†ä¸Šç­è³ºéŒ¢çš„ä¸æ˜¯èŠ±éŒ¢è²·å·¥ä½œçš„",
        "æˆ‘è‡ªæè…°åŒ…å…¨è²·100%ï¼Œè®“ä¸»ç®¡æ«ƒç®¡åœ¨ç¸½å…¬å¸å¾—åˆ°è¡¨æš...é‚„è¦è¢«ä¸»ç®¡è²¶åˆ°è±¬ç‹—ä¸å¦‚...æ˜¯å«æˆ‘å»æ­»å—ğŸ˜­",
        "å£“åŠ›ä¸¦ä¸æœƒæˆç‚ºå‹•åŠ›åªæœƒæˆç‚ºä½ çš„ç—…ã€‚ç„¶å¾Œä½ æŠŠé€™äº›å£æƒ…ç·’å¸¶å›å®¶è£¡ä¹Ÿç›´æ¥å½±éŸ¿åˆ°å®¶åº­è®Šå¾—å¿ƒåŠ›äº¤ç˜ï¼Œç„¶å¾Œæ¨è–¦çš„ETFæª”æª”ç ´ç™¼æ„§å°ä¿¡ä»»è‡ªå·±çš„å®¢æˆ¶æœ‹å‹...",
        "æ‰¾ä¸åˆ°å®¢æˆ¶å°±è‡ªå·±è²·ä¸€è²·ï¼Œåæ­£xxå¤©å¾Œå°±å¯ä»¥å‡ºå ´äº†...é€™å€‹é«”åˆ¶çœŸçš„ç”Ÿç—…äº†",
        "åº•è–ªä¸‰è¬ï¼Œæˆ¿ç§Ÿä¸€è¬äº”ï¼Œåƒé£¯ä¸€è¬ï¼Œäº¤é€šé›œæ”¯äº”åƒ...é€™å¼µå–®ä¸‹å»ï¼Œé€™å€‹æœˆåˆè¦åƒåœŸäº†...é‚„è¦è¢«ç•¶è³Šä¸€æ¨£é˜²è‘—å®¢æˆ¶è·‘æ‰ï¼Œæˆ‘çœŸçš„å¥½ç´¯...",
        "åˆä¾†äº†ï¼Œåˆæ˜¯é€™ç¨®åƒåœ¾å•†å“ï¼Œå®¢æˆ¶ä¸è³ æ­»æ‰æ€ª...ä½†æˆ‘èƒ½æ€éº¼è¾¦ï¼Ÿä¸æ‰›å—ï¼Ÿæ˜å¤©å°±å«æˆ‘æ»¾è›‹äº†...",
        "ç®—äº†ï¼Œè²·å§ï¼Œè²·äº†è‡³å°‘é‚„æœ‰å·¥ä½œ...å§ï¼Ÿåªæ˜¯å¿ƒå¥½ç—›ï¼Œå°ä¸èµ·å®¢æˆ¶ï¼Œä¹Ÿå°ä¸èµ·è‡ªå·±å¤šå¹´çš„å°ˆæ¥­...",
      ];

      // äº¤æ˜“æˆæœ¬å¸¸æ•¸ - ç‡Ÿæ¥­å“¡è‡ªæè…°åŒ…
      const BROKER_BUY_FEE_RATE = (0.1425 * 0.6) / 100; // 0.1425% * 0.6 = 0.0855%
      const BROKER_SELL_FEE_RATE = (0.1425 * 0.6) / 100; // 0.0855%
      const TAX_RATE = 0.1 / 100; // 0.1%

      // éš¨æ©Ÿç­–ç•¥é¸æ“‡ï¼ˆç•¶æ—¥è³£å‡º vs å‡¹å–®ï¼‰
      const STRATEGY_TYPES = ["ç•¶æ—¥è³£å‡º", "å‡¹å–®æœˆåº•è³£å‡º"];

      // --- Utility Functions ---
      function formatNumber(num, decimals = 0) {
        if (typeof num !== "number" || isNaN(num)) return "-";
        return num.toLocaleString("zh-TW", {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals,
        });
      }

      // ç´…æ¼²ç¶ è·Œ - èª¿æ•´è¡¨æ ¼é¡è‰²
      function getPriceClass(value) {
        if (typeof value !== "number" || isNaN(value)) return "table-neutral";
        return value > 0
          ? "table-loss" // è™§æ - ç¶ è‰²
          : value < 0
          ? "table-gain" // ç²åˆ© - ç´…è‰²
          : "table-neutral";
      }

      // ç´…æ¼²ç¶ è·Œ - èª¿æ•´ç™¾åˆ†æ¯”é¡è‰²
      function getPriceClassPercent(value) {
        if (typeof value !== "number" || isNaN(value)) return "table-neutral";
        return value < 0
          ? "table-loss" // è™§æ - ç¶ è‰² (ç™¾åˆ†æ¯”ç‚ºè² )
          : value > 0
          ? "table-gain" // ç²åˆ© - ç´…è‰² (ç™¾åˆ†æ¯”ç‚ºæ­£)
          : "table-neutral";
      }

      // è¨ˆç®—è²·å…¥æ‰‹çºŒè²»
      function calculateBuyFee(price, quantity) {
        return Math.max(20, price * quantity * BROKER_BUY_FEE_RATE); // æœ€ä½æ‰‹çºŒè²»20å…ƒ
      }

      // è¨ˆç®—è³£å‡ºæ‰‹çºŒè²»èˆ‡ç¨…é‡‘
      function calculateSellFeeAndTax(price, quantity) {
        const fee = Math.max(20, price * quantity * BROKER_SELL_FEE_RATE); // æœ€ä½æ‰‹çºŒè²»20å…ƒ
        const tax = price * quantity * TAX_RATE;
        return fee + tax;
      }

      // éš¨æ©Ÿé¸æ“‡IPO
      function getRandomIpo() {
        if (!allIpoData || allIpoData.length === 0) return null;
        // é¸æ“‡æœ‰æ­£å¸¸åƒ¹æ ¼è³‡æ–™çš„IPO
        const validIpos = allIpoData.filter(
          (ipo) =>
            ipo.subPrice > 0 && !isNaN(ipo.dayLow) && !isNaN(ipo.monthLow)
        );
        if (validIpos.length === 0) return null;

        return validIpos[Math.floor(Math.random() * validIpos.length)];
      }

      // --- CSV Parsing and Data Processing ---
      async function loadAndProcessData() {
        try {
          const response = await fetch(CSV_FILE_PATH);
          if (!response.ok) {
            throw new Error(
              `HTTP error! status: ${response.status} while fetching ${CSV_FILE_PATH}`
            );
          }
          const csvText = await response.text();
          const parsedData = parseCSV(csvText);

          allIpoData = parsedData
            .map((item) => {
              const subPrice = parseFloat(item["å‹Ÿé›†åƒ¹æ ¼"]);
              const dayLow = parseFloat(item["æ›ç‰Œç•¶å¤©æœ€ä½"]);
              const monthLow = parseFloat(item["æ›ç›¤å¾Œä¸€å€‹æœˆæœ€ä½"]);

              if (
                isNaN(subPrice) ||
                isNaN(dayLow) ||
                isNaN(monthLow) ||
                subPrice <= 0
              ) {
                console.warn(
                  "Skipping invalid data row (after parsing attempt):",
                  item
                );
                return null;
              }

              const lossDay1Amount = subPrice - dayLow;
              const lossDay1Percent = ((dayLow - subPrice) / subPrice) * 100;
              const lossMonth1Amount = subPrice - monthLow;
              const lossMonth1Percent =
                ((monthLow - subPrice) / subPrice) * 100;

              return {
                name: item["è‚¡ç¥¨åç¨±"] ? item["è‚¡ç¥¨åç¨±"].trim() : "N/A",
                date: item["ä¸Šå¸‚æ—¥"] ? item["ä¸Šå¸‚æ—¥"].trim() : "N/A",
                subPrice,
                dayLow,
                monthLow,
                lossDay1Amount,
                lossDay1Percent,
                lossMonth1Amount,
                lossMonth1Percent,
              };
            })
            .filter((item) => item !== null);

          if (allIpoData.length === 0) {
            console.error(
              "No valid IPO data loaded. Check CSV format and headers."
            );
            displayErrorMessage(
              "æœªèƒ½å¾CSVæª”æ¡ˆè¼‰å…¥æœ‰æ•ˆçš„IPOè³‡æ–™ã€‚è«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼ã€æ¬„ä½åç¨± (å¦‚ï¼šå‹Ÿé›†åƒ¹æ ¼, æ›ç‰Œç•¶å¤©æœ€ä½, æ›ç›¤å¾Œä¸€å€‹æœˆæœ€ä½, è‚¡ç¥¨åç¨±, ä¸Šå¸‚æ—¥) æ˜¯å¦æ­£ç¢ºã€‚"
            );
            return;
          }

          populateTable(allIpoData);
          calculateAndDisplayStats(allIpoData);
          createOrUpdateCharts(allIpoData);
          displayBrokerLossStatement(allIpoData);
        } catch (error) {
          console.error("Error loading or processing IPO data:", error);
          displayErrorMessage(
            `è¼‰å…¥IPOè³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}ã€‚è«‹ç¢ºèª '${CSV_FILE_PATH}' æª”æ¡ˆå­˜åœ¨ä¸”æ ¼å¼æ­£ç¢ºã€‚`
          );
        }
      }

      function parseCSV(csvText) {
        const lines = csvText.trim().split(/\r?\n/);
        if (lines.length < 2) return [];

        const headers = lines[0].split(",").map((header) => header.trim());
        const data = [];

        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(",");
          if (
            values.length !== headers.length ||
            lines[i].trim() === "" ||
            values.every((v) => v.trim() === "")
          ) {
            console.warn(`Skipping malformed CSV line ${i + 1}: ${lines[i]}`);
            continue;
          }
          const entry = {};
          headers.forEach((header, index) => {
            entry[header] = values[index] ? values[index].trim() : "";
          });
          data.push(entry);
        }
        return data;
      }

      function displayErrorMessage(message) {
        const tableBody = document.getElementById("ipo-table-body");
        if (tableBody) {
          tableBody.innerHTML = `<tr><td colspan="9" class="text-center p-8 text-red-500 font-semibold">${message}</td></tr>`;
        }
        const simulationResultDiv = document.getElementById("simulationResult");
        if (simulationResultDiv) {
          simulationResultDiv.innerHTML = `<p class="text-red-500 font-semibold">${message}</p>`;
          simulationResultDiv.classList.remove("hidden");
        }
      }

      // --- DOM Manipulation and Display ---
      function populateTable(data) {
        const tableBody = document.getElementById("ipo-table-body");
        if (!tableBody) return;
        tableBody.innerHTML = "";

        if (data.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="9" class="text-center p-8 text-gray-500">æ²’æœ‰å¯é¡¯ç¤ºçš„IPOè³‡æ–™ã€‚</td></tr>`;
          return;
        }

        data.forEach((item) => {
          const row = tableBody.insertRow();
          row.innerHTML = `
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-700">${
                  item.name
                }</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">${
                  item.date
                }</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-right">${formatNumber(
                  item.subPrice
                )}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-right">${formatNumber(
                  item.dayLow
                )}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-right">${formatNumber(
                  item.monthLow
                )}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-right ${getPriceClass(
                  item.lossDay1Amount
                )}">${formatNumber(item.lossDay1Amount)}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-right ${getPriceClassPercent(
                  item.lossDay1Percent
                )}">${formatNumber(item.lossDay1Percent, 1)}%</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-right ${getPriceClass(
                  item.lossMonth1Amount
                )}">${formatNumber(item.lossMonth1Amount)}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-right ${getPriceClassPercent(
                  item.lossMonth1Percent
                )}">${formatNumber(item.lossMonth1Percent, 1)}%</td>
            `;
        });
      }

      function populateIpoSelect(data) {
        const ipoSelect = document.getElementById("ipoSelect");
        if (!ipoSelect) return;
        ipoSelect.innerHTML = '<option value="">è«‹é¸æ“‡ä¸€å€‹IPOé€²è¡Œæ¨¡æ“¬</option>';

        // Use all IPO data for the selection
        const sourceForSelect = data;

        if (sourceForSelect.length === 0) {
          ipoSelect.innerHTML =
            '<option value="">ç„¡å¯ç”¨IPOè³‡æ–™é€²è¡Œæ¨¡æ“¬</option>';
          document.getElementById("runSimulationBtn").disabled = true; // Disable button if no IPOs
          return;
        }
        document.getElementById("runSimulationBtn").disabled = false;

        sourceForSelect.forEach((ipo, index) => {
          // Use the actual index from the allIpoData array
          const option = document.createElement("option");
          option.value = index; // Use index as the value
          option.textContent = `${ipo.name} (å‹Ÿé›†åƒ¹: ${formatNumber(
            ipo.subPrice,
            2
          )}, é¦–æ—¥æœ€ä½: ${formatNumber(ipo.dayLow, 2)})`;
          ipoSelect.appendChild(option);
        });
      }

      // --- Statistics Calculation ---
      function calculateAndDisplayStats(data) {
        const totalIPOs = data.length;
        if (totalIPOs === 0) {
          document.getElementById("stats-breakeven-day1").textContent = `N/A`;
          document.getElementById("stats-breakeven-month1").textContent = `N/A`;
          document.getElementById("stats-avg-loss-day1").textContent = `N/A`;
          document.getElementById("stats-avg-loss-month1").textContent = `N/A`;
          return;
        }

        const brokeDay1Count = data.filter((d) => d.dayLow < d.subPrice).length;
        const brokeMonth1Count = data.filter(
          (d) => d.monthLow < d.subPrice
        ).length;

        document.getElementById(
          "stats-breakeven-day1"
        ).textContent = `${formatNumber(
          (brokeDay1Count / totalIPOs) * 100,
          1
        )}%`;
        document.getElementById(
          "stats-breakeven-month1"
        ).textContent = `${formatNumber(
          (brokeMonth1Count / totalIPOs) * 100,
          1
        )}%`;

        const lossesDay1Percent = data
          .filter((d) => d.dayLow < d.subPrice)
          .map((d) => d.lossDay1Percent);
        const avgLossDay1 =
          lossesDay1Percent.length > 0
            ? lossesDay1Percent.reduce((a, b) => a + b, 0) /
              lossesDay1Percent.length
            : 0;
        document.getElementById(
          "stats-avg-loss-day1"
        ).textContent = `${formatNumber(avgLossDay1, 1)}%`;

        const lossesMonth1Percent = data
          .filter((d) => d.monthLow < d.subPrice)
          .map((d) => d.lossMonth1Percent);
        const avgLossMonth1 =
          lossesMonth1Percent.length > 0
            ? lossesMonth1Percent.reduce((a, b) => a + b, 0) /
              lossesMonth1Percent.length
            : 0;
        document.getElementById(
          "stats-avg-loss-month1"
        ).textContent = `${formatNumber(avgLossMonth1, 1)}%`;
      }

      // --- Chart Creation ---
      function createOrUpdateCharts(data) {
        const totalIPOs = data.length;
        if (totalIPOs === 0) return;

        const brokeDay1Count = data.filter((d) => d.dayLow < d.subPrice).length;
        const brokeMonth1Count = data.filter(
          (d) => d.monthLow < d.subPrice
        ).length;

        const breakevenPieCtx = document
          .getElementById("breakevenPieChart")
          ?.getContext("2d");
        if (!breakevenPieCtx) return;
        if (breakevenPieChartInstance) {
          breakevenPieChartInstance.destroy();
        }

        // ç´…æ¼²ç¶ è·Œ - èª¿æ•´åœ–è¡¨é¡è‰²
        breakevenPieChartInstance = new Chart(breakevenPieCtx, {
          type: "pie",
          data: {
            labels: [
              "ä¸Šå¸‚ç•¶æ—¥ç ´ç™¼",
              "ä¸Šå¸‚ç•¶æ—¥æœªç ´ç™¼",
              "ä¸€å€‹æœˆå¾Œç ´ç™¼",
              "ä¸€å€‹æœˆå¾Œæœªç ´ç™¼",
            ],
            datasets: [
              {
                label: "IPOç ´ç™¼çµ±è¨ˆ",
                data: [
                  brokeDay1Count,
                  totalIPOs - brokeDay1Count,
                  brokeMonth1Count,
                  totalIPOs - brokeMonth1Count,
                ],
                backgroundColor: [
                  "rgba(34, 197, 94, 0.8)", // Green-500 (ç ´ç™¼ - ç¶ è‰²)
                  "rgba(239, 68, 68, 0.7)", // Red-500 (æœªç ´ç™¼ - ç´…è‰²)
                  "rgba(22, 163, 74, 0.9)", // Green-600 (ç ´ç™¼ - æ·±ç¶ è‰²)
                  "rgba(220, 38, 38, 0.8)", // Red-600 (æœªç ´ç™¼ - æ·±ç´…è‰²)
                ],
                borderColor: ["#FFFFFF"],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: "top" },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    let label = context.label || "";
                    if (label) {
                      label += ": ";
                    }
                    if (context.parsed !== null) {
                      label += `${context.parsed} æª” (${formatNumber(
                        (context.parsed / totalIPOs) * 100,
                        1
                      )}%)`;
                    }
                    return label;
                  },
                },
              },
            },
          },
        });

        const lossDistributionCtx = document
          .getElementById("lossDistributionBarChart")
          ?.getContext("2d");
        if (!lossDistributionCtx) return;
        const lossMonth1Percentages = data
          .map((d) => d.lossMonth1Percent)
          .filter((p) => !isNaN(p));
        const simpleBinLabels = [
          "è™§æ >10%",
          "è™§æ 5-10%",
          "è™§æ 0-5%",
          "ç²åˆ© 0-5%",
          "ç²åˆ© 5-10%",
          "ç²åˆ© >10%",
        ];
        const simpleBinCounts = Array(simpleBinLabels.length).fill(0);

        lossMonth1Percentages.forEach((p) => {
          if (p < -10) simpleBinCounts[0]++;
          else if (p < -5) simpleBinCounts[1]++;
          else if (p < 0) simpleBinCounts[2]++;
          else if (p <= 5) simpleBinCounts[3]++;
          else if (p <= 10) simpleBinCounts[4]++;
          else simpleBinCounts[5]++;
        });

        if (lossDistributionBarChartInstance) {
          lossDistributionBarChartInstance.destroy();
        }

        // ç´…æ¼²ç¶ è·Œ - èª¿æ•´åœ–è¡¨é¡è‰²
        lossDistributionBarChartInstance = new Chart(lossDistributionCtx, {
          type: "bar",
          data: {
            labels: simpleBinLabels,
            datasets: [
              {
                label: "IPOæ•¸é‡ (ä¸€å€‹æœˆå¾Œæ½›åœ¨å ±é…¬ç‡)",
                data: simpleBinCounts,
                backgroundColor: [
                  "rgba(22, 163, 74, 0.8)", // Green-600 (è™§æ>10% - æ·±ç¶ è‰²)
                  "rgba(34, 197, 94, 0.7)", // Green-500 (è™§æ5-10% - ç¶ è‰²)
                  "rgba(134, 239, 172, 0.7)", // Green-300 (è™§æ0-5% - æ·ºç¶ è‰²)
                  "rgba(252, 165, 165, 0.7)", // Red-300 (ç²åˆ©0-5% - æ·ºç´…è‰²)
                  "rgba(239, 68, 68, 0.7)", // Red-500 (ç²åˆ©5-10% - ç´…è‰²)
                  "rgba(220, 38, 38, 0.8)", // Red-600 (ç²åˆ©>10% - æ·±ç´…è‰²)
                ],
                borderColor: ["#FFFFFF"],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "IPO æ•¸é‡" },
              },
              x: { title: { display: true, text: "ä¸€å€‹æœˆå¾Œæ½›åœ¨å ±é…¬ç‡å€é–“" } },
            },
            plugins: { legend: { display: false } },
          },
        });
      }

      function displayBrokerLossStatement(data) {
        const statementBody = document.getElementById(
          "broker-loss-statement-body"
        );
        const totalLossEl = document.getElementById("broker-total-loss");
        if (!statementBody || !totalLossEl) return;

        statementBody.innerHTML = ""; // Clear previous content
        let overallTotalLoss = 0;

        if (data.length === 0) {
          statementBody.innerHTML = `<tr><td colspan="10" class="text-center p-4 text-gray-500">æ²’æœ‰IPOè³‡æ–™å¯ä¾›æ¨¡æ“¬éšŠé•·å–®ã€‚</td></tr>`;
          totalLossEl.textContent = "0 å…ƒ";
          return;
        }

        // é¡¯ç¤ºæœ€å¤š10ç­†IPOæ•¸æ“š
        const dataToShow = data
          .filter((ipo) => ipo.subPrice > 0 && !isNaN(ipo.dayLow))
          .slice(0, Math.min(data.length, 10));

        dataToShow.forEach((ipo) => {
          if (ipo.subPrice <= 0) return; // è·³éç„¡æ•ˆåƒ¹æ ¼

          // éš¨æ©Ÿèªè³¼é‡‘é¡ (30è¬-600è¬)
          const randomSubscriptionAmount =
            Math.floor(Math.random() * (6000000 - 300000 + 1)) + 300000;
          const sharesToBuy = Math.floor(
            randomSubscriptionAmount / ipo.subPrice
          );

          if (sharesToBuy === 0) return; // ä¸è¶³ä»¥è²·ä¸€è‚¡

          // è¨ˆç®—å¯¦éš›æˆæœ¬èˆ‡è³£å‡ºåƒ¹å€¼
          const actualCost = sharesToBuy * ipo.subPrice;
          const buyFee = calculateBuyFee(ipo.subPrice, sharesToBuy);
          const saleValueAtDayLow = sharesToBuy * ipo.dayLow;
          const sellFeeAndTax = calculateSellFeeAndTax(ipo.dayLow, sharesToBuy);

          // ç¸½è™§æ = è²·å…¥æˆæœ¬ + è²·å…¥æ‰‹çºŒè²» - è³£å‡ºåƒ¹å€¼ + è³£å‡ºæ‰‹çºŒè²»èˆ‡ç¨…é‡‘
          const lossForThisIpo =
            actualCost + buyFee - saleValueAtDayLow + sellFeeAndTax;
          overallTotalLoss += lossForThisIpo;

          const row = statementBody.insertRow();
          row.innerHTML = `
            <td class="whitespace-nowrap px-2 py-2 text-gray-700">${
              ipo.name
            }</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              ipo.subPrice
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              ipo.dayLow
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              randomSubscriptionAmount
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              sharesToBuy
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              buyFee
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              sellFeeAndTax
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              actualCost
            )}</td>
            <td class="text-right px-2 py-2 text-gray-500">${formatNumber(
              saleValueAtDayLow
            )}</td>
            <td class="text-right px-2 py-2 ${
              lossForThisIpo > 0
                ? "text-green-500 font-semibold"
                : lossForThisIpo < 0
                ? "text-red-500 font-semibold"
                : "text-gray-500"
            }">${formatNumber(lossForThisIpo)}</td>
          `;
        });

        // ç´…æ¼²ç¶ è·Œ - èª¿æ•´é¡è‰²
        totalLossEl.textContent = `${formatNumber(overallTotalLoss)} å…ƒ`;
        totalLossEl.className = `px-2 py-2 text-right text-sm font-bold ${
          overallTotalLoss > 0
            ? "text-green-600"
            : overallTotalLoss < 0
            ? "text-red-600"
            : "text-gray-700"
        }`;
      }

      // --- Simulation Logic ---
      function runSimulation() {
        const resultDiv = document.getElementById("simulationResult");
        if (!resultDiv) {
          console.error("Simulation result element not found.");
          return;
        }

        resultDiv.classList.remove("hidden");
        resultDiv.innerHTML = ""; // Clear previous results

        // éš¨æ©Ÿé¸æ“‡ä¸€å€‹IPOæ¨™çš„
        const ipo = getRandomIpo();

        if (!ipo) {
          resultDiv.innerHTML = `<p class="text-red-500 font-semibold p-4">æœªæ‰¾åˆ°æœ‰æ•ˆçš„IPOè³‡æ–™ï¼Œç„¡æ³•é€²è¡Œæ¨¡æ“¬ã€‚</p>`;
          return;
        }

        if (ipo.subPrice <= 0) {
          resultDiv.innerHTML = `<p class="text-red-500 font-semibold p-4">é¸ä¸­çš„IPOå‹Ÿé›†åƒ¹æ ¼ç„¡æ•ˆï¼Œç„¡æ³•é€²è¡Œæ¨¡æ“¬ã€‚</p>`;
          return;
        }

        // æ›´å‹•æ…‹ä¸”æ›´å¯¬çš„è²¬ä»»é¡ç¯„åœ
        const randomResponsibilityAmount =
          Math.floor(Math.random() * (2500000 - 300000 + 1)) + 300000; // 30è¬åˆ°250è¬ä¹‹é–“

        const randomPressureQuote =
          EXTENDED_PRESSURE_QUOTES[
            Math.floor(Math.random() * EXTENDED_PRESSURE_QUOTES.length)
          ];
        const randomMonologue =
          BROKER_INNER_MONOLOGUES[
            Math.floor(Math.random() * BROKER_INNER_MONOLOGUES.length)
          ];

        const sharesToBuy = Math.floor(
          randomResponsibilityAmount / ipo.subPrice
        );

        // éš¨æ©Ÿé¸æ“‡è³£å‡ºç­–ç•¥: ç•¶æ—¥è³£å‡º æˆ– å‡¹å–®æœˆåº•è³£å‡º
        const sellStrategy =
          STRATEGY_TYPES[Math.floor(Math.random() * STRATEGY_TYPES.length)];
        const sellPrice =
          sellStrategy === "ç•¶æ—¥è³£å‡º" ? ipo.dayLow : ipo.monthLow;
        const sellDayDescription =
          sellStrategy === "ç•¶æ—¥è³£å‡º" ? "ä¸Šå¸‚ç•¶æ—¥" : "å‡¹å–®ä¸€å€‹æœˆå¾Œ";

        // è¨ˆç®—æˆæœ¬èˆ‡è³£å‡ºåƒ¹å€¼ (åŒ…å«æ‰‹çºŒè²»)
        const actualCost = sharesToBuy * ipo.subPrice;
        const buyFee = calculateBuyFee(ipo.subPrice, sharesToBuy);
        const saleValue = sharesToBuy * sellPrice;
        const sellFeeAndTax = calculateSellFeeAndTax(sellPrice, sharesToBuy);

        // ç¸½è™§æ = è²·å…¥æˆæœ¬ + è²·å…¥æ‰‹çºŒè²» - è³£å‡ºåƒ¹å€¼ + è³£å‡ºæ‰‹çºŒè²»èˆ‡ç¨…é‡‘
        const lossAmount = actualCost + buyFee - saleValue + sellFeeAndTax;
        const lossPercent =
          actualCost > 0 ? (lossAmount / actualCost) * 100 : 0;

        let simulationContent = `<h3 class="text-xl font-semibold text-gray-800 mb-3">å£“åŠ›é‹ä¸‹çš„æ¨¡æ“¬çµæœ:</h3>`;
        simulationContent += `<p class="pressure-quote">ä¸»ç®¡ï¼š${randomPressureQuote}</p>`;

        // Forced choice narrative
        simulationContent += `
          <div class="my-4 p-3 border border-yellow-400 bg-yellow-50 rounded-md">
            <p class="font-semibold text-yellow-700">å…§å¿ƒçš„æ™æ‰ï¼š</p>
            <p class="text-sm text-gray-600">ã€Œåˆä¾†äº†...ä¸»ç®¡çš„è©±åƒç·Šç®å’’ä¸€æ¨£ã€‚æˆ‘èƒ½æ€éº¼è¾¦ï¼Ÿé€™å€‹æœˆè–ªæ°´æ‰ä¸‰è¬å‡ºé ­ï¼Œå®¶è£¡é‚„æœ‰é–‹éŠ·...ã€</p>
            <ul class="list-disc list-inside text-sm text-gray-500 mt-2">
                <li>é¸é …ä¸€ï¼šæ‹’çµ•ï¼Œç„¶å¾Œç­‰è‘—è¢«åˆé›£ã€è¢«ç§»èµ°å®¢æˆ¶ï¼Œç”šè‡³...æ²’å·¥ä½œï¼Ÿ</li>
                <li>é¸é …äºŒï¼šæ‰¾è¦ªå‹å¹«å¿™ï¼Ÿä¸Šæ¬¡é‚£å€‹ETFä»–å€‘è³ éŒ¢åˆ°ç¾åœ¨é‚„åœ¨å”¸...</li>
                <li>é¸é …ä¸‰ï¼šè‡ªå·±ç¡¬å...ç¥ˆç¦±é€™æ¬¡é‹æ°£å¥½ä¸€é»ï¼Ÿ</li>
            </ul>
            <p class="mt-2 text-sm text-gray-600">ã€Œç®—äº†...ç‚ºäº†é£¯ç¢—ï¼Œåªèƒ½åäº†...ã€</p>
          </div>
        `;

        if (sharesToBuy === 0) {
          simulationContent += `<p class="text-orange-600 bg-orange-100 p-3 rounded-md">æ¨¡æ“¬çš„è²¬ä»»é¡ ${formatNumber(
            randomResponsibilityAmount
          )} å…ƒï¼Œä¸è¶³ä»¥è³¼è²·è‡³å°‘ä¸€è‚¡ <strong class="font-bold">${
            ipo.name
          }</strong> (å‹Ÿé›†åƒ¹ ${formatNumber(
            ipo.subPrice
          )} å…ƒ/è‚¡)ã€‚ä¸»ç®¡å¯èƒ½é‚„æ˜¯æœƒèªªï¼šã€Œé‡‘é¡å¤ªå°‘ï¼Ÿé‚£ä½ å†å¤šã€åŠªåŠ›ã€ä¸€é»å•Šï¼ã€</p>`;
          resultDiv.innerHTML = simulationContent;
          return;
        }

        simulationContent += `
            <p class="simulation-result-item"><strong>è¢«è¿«æ±ºå®šï¼š</strong>åœ¨å·¨å¤§å£“åŠ›ä¸‹ï¼Œæ‚¨ã€Œæ±ºå®šã€æ‰›ä¸‹ <span class="font-bold text-red-600">${formatNumber(
              randomResponsibilityAmount
            )}</span> å…ƒçš„ã€Œç›®æ¨™ã€ï¼Œä»¥æ¯è‚¡ <span class="font-bold text-blue-600">${formatNumber(
          ipo.subPrice
        )}</span> å…ƒçš„å‹Ÿé›†åƒ¹æ ¼ï¼Œèªè³¼ <span class="font-bold text-blue-600">${
          ipo.name
        }</span> å…± <span class="font-bold text-blue-600">${formatNumber(
          sharesToBuy
        )}</span> è‚¡ã€‚</p>
            <p class="simulation-result-item text-xs text-gray-500">ï¼ˆå¯¦éš›ç¸½æŠ•è³‡æˆæœ¬ç‚º <span class="font-bold text-blue-600">${formatNumber(
              actualCost
            )}</span> å…ƒï¼ŒåŠ ä¸Šè²·å…¥æ‰‹çºŒè²» <span class="font-bold text-blue-600">${formatNumber(
          buyFee
        )}</span> å…ƒï¼Œå› è‚¡æ•¸å–æ•´ï¼Œå¯èƒ½èˆ‡ç›®æ¨™é¡ç•¥æœ‰å·®ç•°ï¼‰</p>
            <hr class="my-3">
            <p class="simulation-result-item"><strong>ç­‰å¾…èˆ‡ç…ç†¬ï¼š</strong>çµ‚æ–¼ç­‰åˆ° ${
              ipo.name
            } ä¸Šå¸‚ (${ipo.date})...æ‰“é–‹çœ‹ç›¤è»Ÿé«”ï¼Œå¿ƒä¸€æ²‰...</p>
            <p class="simulation-result-item"><strong>${sellStrategy}ï¼š</strong>æ‚¨è¢«è¿«åœ¨${sellDayDescription}<strong class="text-red-500">æœ€ä½åƒ¹</strong>æ¯è‚¡ <span class="font-bold ${
          sellPrice < ipo.subPrice ? "text-green-500" : "text-red-500"
        }">${formatNumber(sellPrice)}</span> å…ƒæ™‚ï¼Œå°‡æ‰€æœ‰ ${formatNumber(
          sharesToBuy
        )} è‚¡æŒè‚¡è³£å‡ºã€‚</p>
            <hr class="my-4 border-dashed">
            <div class="p-4 bg-gray-100 rounded-md mt-4">
                <h4 class="text-lg font-semibold text-gray-700 mb-2">è¡€æ·‹æ·‹çš„å°å¸³å–®çµæœï¼š</h4>
                <p class="simulation-result-item"><strong>è²·å…¥ç¸½æˆæœ¬ï¼š</strong>${formatNumber(
                  actualCost
                )} å…ƒ</p>
                <p class="simulation-result-item"><strong>è²·å…¥æ‰‹çºŒè²» (0.0855%)ï¼š</strong>${formatNumber(
                  buyFee
                )} å…ƒ</p>
                <p class="simulation-result-item"><strong>è³£å‡ºç¸½é‡‘é¡ï¼š</strong>${formatNumber(
                  saleValue
                )} å…ƒ</p>
                <p class="simulation-result-item"><strong>è³£å‡ºæ‰‹çºŒè²»+ç¨… (0.0855%+0.1%)ï¼š</strong>${formatNumber(
                  sellFeeAndTax
                )} å…ƒ</p>
                <p class="simulation-result-item final-loss-figure"><strong>ç¸½è¨ˆæç›Šï¼š</strong><span class="${
                  lossAmount > 0
                    ? "text-green-600"
                    : lossAmount < 0
                    ? "text-red-600"
                    : "text-gray-700"
                }">${
          lossAmount > 0 ? "-" : lossAmount < 0 ? "+" : ""
        }${formatNumber(Math.abs(lossAmount))} å…ƒ</span></p>
                <p class="simulation-result-item"><strong>å ±é…¬ç‡ï¼š</strong><span class="${
                  lossAmount > 0
                    ? "text-green-600 font-bold"
                    : lossAmount < 0
                    ? "text-red-600 font-bold"
                    : "text-gray-700 font-bold"
                }">${formatNumber(
          lossAmount > 0 ? lossPercent : -lossPercent,
          2
        )}% ${
          lossAmount > 0 ? "(è™§æ)" : lossAmount < 0 ? "(ç²åˆ©)" : "(æŒå¹³)"
        }</span></p>
            </div>
            <div class="broker-monologue sad-text-effect mt-4">
                <p class="font-semibold">ç‡Ÿæ¥­å“¡çš„å…§å¿ƒç¨ç™½ (åº•è–ªä¸‰è¬çš„æ‚²é³´)ï¼š</p>
                <p>${randomMonologue}</p>
                ${
                  lossAmount > 0
                    ? '<p class="mt-2 text-red-700 font-semibold">çœ‹è‘—å°å¸³å–®ä¸Šçš„æ•¸å­—ï¼Œå¿ƒæ¶¼äº†åŠæˆª...é€™å€‹æœˆçš„è–ªæ°´ï¼Œåˆä¸çŸ¥é“è¦æ€éº¼å¡«é€™å€‹å‘äº†...</p>'
                    : '<p class="mt-2 text-green-700 font-semibold">è¬å¹¸ï¼é€™æ¬¡å±…ç„¶æ²’è³ é‚„å°è³ºï¼ä½†é€™ç¨®æå¿ƒåŠè†½çš„æ—¥å­ï¼Œé‚„è¦éå¤šä¹…...</p>'
                }
            </div>
        `;
        resultDiv.innerHTML = simulationContent;
      }

      // --- Event Listeners and Initialization ---
      document.addEventListener("DOMContentLoaded", () => {
        loadAndProcessData();
        const currentYearEl = document.getElementById("currentYear");
        if (currentYearEl) {
          currentYearEl.textContent = new Date().getFullYear();
        }

        const runSimulationButton = document.getElementById("runSimulationBtn");
        if (runSimulationButton) {
          runSimulationButton.addEventListener("click", runSimulation);
        } else {
          console.error("Simulation button not found");
        }
      });
    </script>
  </body>
</html>
